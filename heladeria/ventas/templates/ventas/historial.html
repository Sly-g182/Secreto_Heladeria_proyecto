{% extends "base.html" %}

{% block title %}Mi Historial de Pedidos{% endblock %}

{% block content %}
<div class="container py-5">
    <h1 class="mb-5 text-center fw-bold text-primary-emphasis">
        Historial de Pedidos
    </h1>

    {% if ventas %}
        {% for venta in ventas %}
        <div class="card mb-5 border-0 shadow-lg rounded-4 overflow-hidden bg-white">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center py-3 px-4">
                <h5 class="mb-0 fw-semibold">
                    üßæ Venta #{{ venta.id }} 
                    <small class="text-light opacity-75 ms-2">({{ venta.fecha_venta|date:"d M Y - H:i" }})</small>
                </h5>
                <span class="badge bg-light text-dark px-3 py-2 fs-6 shadow-sm">
                    Total: ${{ venta.total|floatformat:0 }}
                </span>
            </div>

            <div class="card-body px-4 py-4 bg-body-secondary">
                <h6 class="border-bottom pb-2 mb-3 text-secondary fw-bold">
                    Detalles de la Venta:
                </h6>

                <ul class="list-group list-group-flush">
                    {% for detalle in venta.detalles.all %}
                    <li class="list-group-item bg-transparent d-flex justify-content-between align-items-center py-3 border-0 border-bottom">
                        <div class="col-8">
                            <span class="fw-bold text-dark text-capitalize">{{ detalle.producto.nombre }}</span>
                            <small class="text-muted d-block">
                                {% if detalle.precio_unitario < detalle.producto.precio %}
                                    üíµ <s>${{ detalle.producto.precio|floatformat:0 }}</s> ‚Üí <span class="text-success">${{ detalle.precio_unitario|floatformat:0 }}</span> c/u
                                {% else %}
                                    üíµ ${{ detalle.precio_unitario|floatformat:0 }} c/u
                                {% endif %}
                            </small>
                        </div>

                        <div class="col-4 text-end">
                            <span class="me-3 text-secondary">{{ detalle.cantidad }} Unidades</span>
                            <span class="fw-bold text-success">${{ detalle.subtotal|floatformat:0 }}</span>
                        </div>
                    </li>
                    {% endfor %}
                </ul>

                <p class="text-end mt-4 fw-bold pt-3 border-top border-2">
                    Total Pagado: ${{ venta.total|floatformat:0 }}
                </p>
            </div>
        </div>
        {% endfor %}

    {% else %}
    <div class="alert alert-light text-center mt-5 p-5 border-0 shadow-lg rounded-4 bg-body-secondary">
        <p class="lead mb-4 text-secondary fw-semibold">
            A√∫n no has realizado ninguna compra. ¬°Es hora de probar nuestros sabores!
        </p>
        <a href="{% url 'productos:producto_listado' %}" class="btn btn-primary btn-lg shadow-sm rounded-pill px-4 py-2">
            üç¶ Ir a la Tienda
        </a>
    </div>
    {% endif %}
</div>

<style>
h1 {
    color: #0d6efd;
    text-shadow: 1px 1px 3px rgba(13, 110, 253, 0.15);
}
.card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
}
.list-group-item:last-child {
    border-bottom: none;
}
.badge {
    border-radius: 0.75rem;
}
.btn-primary {
    background-color: #0d6efd;
    border: none;
}
.btn-primary:hover {
    background-color: #0b5ed7;
}
</style>
{% endblock %}
